:root {
  --bg: #0b0f14; /* глубокий тёмный фон без текстур */
  --surface: #121820; /* панели */
  --text: #e6e8ea; /* нейтральный светлый */
  --muted: #9aa3ad; /* мягкий серо-синий */
  --primary: #ffd84d; /* жёлтый акцент */
  --primary-glass: rgba(255, 216, 77, 0.12); /* стеклянный слой */
  --primary-border: rgba(255, 216, 77, 0.35);
  --success: #38b26b;
  --danger: #e25555;
  --outline: #2a3340; /* нейтральный бордер */
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0; 
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
  color: var(--text);
  background: var(--bg);
}
header, footer { padding: 16px; background: #0e131a; border-bottom: 1px solid var(--outline); }
header h1 { margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; letter-spacing: 0.4px; }
main { padding: 16px; max-width: 960px; margin: 0 auto; }
h2 { margin: 16px 0; }

.row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
.grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
.card { background: var(--surface); padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--outline); }
.add-form, .filters, .summary, .list, .tools { background: var(--surface); padding: 12px; border-radius: 10px; margin-bottom: 16px; border: 1px solid var(--outline); box-shadow: 0 0 0 1px var(--primary-glass) inset; }
.meta { background: var(--surface); padding: 12px; border-radius: 10px; margin-bottom: 16px; border: 1px solid var(--outline); box-shadow: 0 0 0 1px var(--primary-glass) inset; }

label { display: flex; flex-direction: column; font-size: 14px; color: var(--muted); }
input, select, button { padding: 9px 12px; border-radius: 8px; border: 1px solid var(--outline); background: #0f141b; color: var(--text); transition: background-color 120ms, box-shadow 120ms, border-color 120ms; }
input[type=date] { min-width: 160px; }
.grow { flex: 1; }
.actions { display: flex; gap: 8px; }
button { cursor: pointer; border-color: var(--outline); background: #121a24; color: var(--text); }
button { font-weight: 600; }
button.secondary { background: #1f2937; border-color: #374151; color: #e5e7eb; }
button.danger { background: #201214; border-color: #4a1e22; color: #ffd6d6; }
button:hover { border-color: var(--primary-border); box-shadow: 0 0 0 2px var(--primary-glass) inset; filter: brightness(1.08); }
button:focus { outline: none; box-shadow: 0 0 0 3px var(--primary-glass); border-color: var(--primary-border); }
input:focus, select:focus { outline: none; border-color: var(--primary-border); box-shadow: 0 0 0 2px var(--primary-glass); }

ul { list-style: none; padding: 0; margin: 0; }
li.item { display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center; background: #0f141b; padding: 12px; border-radius: 10px; margin-bottom: 10px; border: 1px solid var(--outline); }
.item .meta { color: var(--muted); font-size: 12px; }
.item .amount { font-weight: bold; }
.item.expense .amount { color: var(--danger); }
.item.income .amount { color: var(--success); }
.item .actions { display: flex; gap: 8px; }
.item .delete { background: #3a1515; color: #f3d6d6; border-color: #7a1f1f; }

footer { text-align: center; color: var(--muted); }

/* График месячных сумм */
#chart-monthly { 
  display: block; 
  width: 100%; 
  height: 220px; 
  background: #0f141b; 
  border: 1px solid var(--outline); 
  border-radius: 10px; 
  contain: layout paint;
}

#chart-categories {
  display: block;
  width: 100%;
  height: 260px;
  background: #0f141b;
  border: 1px solid var(--outline);
  border-radius: 10px;
  margin-top: 8px;
  contain: layout paint;
}

/* Единообразные стили для остальных графиков */
#chart-balance {
  display: block;
  width: 100%;
  height: 220px;
  background: #0f141b;
  border: 1px solid var(--outline);
  border-radius: 10px;
  contain: layout paint;
}

#chart-donut {
  display: block;
  width: 100%;
  height: 260px;
  background: #0f141b;
  border: 1px solid var(--outline);
  border-radius: 10px;
  /* мягкая внешняя тень для глубины */
  filter: drop-shadow(0 10px 24px rgba(0,0,0,0.35));
  contain: layout paint;
}

/* Скрытие графиков без перерасчёта макета */
.chart-hidden {
  display: none !important;
}

/* Единый стиль тултипов для графиков */
.chart-tooltip {
  position: fixed;
  z-index: 1000;
  pointer-events: none;
  background: rgba(255,255,255,0.95);
  color: #0b0f14;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 6px 8px;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
  font-weight: 600;
  font-size: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  opacity: 0;
}

.hint { color: var(--muted); }

@media (max-width: 640px) {
  .grid { grid-template-columns: 1fr; }
}
.brand-row { display: flex; align-items: center; gap: 12px; }
.crest { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #0f221b; border: 2px solid var(--accent); color: var(--accent); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-weight: 700; }
.titles h1 { margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; letter-spacing: 0.5px; }
.titles p { margin: 2px 0 0; color: var(--muted); }

/* Admin programmer bar */
.admin-bar { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
.chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 8px; border: 1px solid var(--outline); background: var(--primary-glass); color: var(--text); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px; }
.chip strong { color: #1a1c20; background: rgba(255,255,255,0.6); padding: 0 4px; border-radius: 4px; }
/* Фиксированная ширина поля статуса синхронизации, чтобы текст (idle/ok/pushing)
   не менял размер ячейки и не смещал панель. Ширина под слово "pushing". */
#status-sync { display: inline-block; min-width: 8ch; text-align: center; }
/* Цветовые варианты для чипов статуса сумм */
.chip strong.pos { color: var(--success); background: rgba(16, 185, 129, 0.15); }
.chip strong.neg { color: var(--danger); background: rgba(226, 85, 85, 0.15); }
.chip strong.bal { color: #3b82f6; background: rgba(59, 130, 246, 0.15); }

/* Wall Street ticker */
.ticker { position: relative; overflow: hidden; margin-top: 8px; border-top: 1px solid var(--outline); border-bottom: 1px solid var(--outline); background: #0c1117; }
.ticker .marquee { display: flex; gap: 18px; padding: 8px 12px; position: relative; contain: content; }
.ticker .marquee.no-anim { animation: none; }
.ticker .tick { color: var(--text); opacity: 0.9; border-left: 2px solid var(--primary-border); padding-left: 10px; will-change: transform; }
/* Изменение за 24ч: цветовые акценты */
.ticker .change.pos { color: var(--success); }
.ticker .change.neg { color: var(--danger); }
.ticker .change.flat { color: var(--muted); }
@keyframes ticker-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }

/* Retro minimal accents */
.card, .add-form, .filters, .summary, .list, .tools { backdrop-filter: blur(2px); }
.hint { color: var(--muted); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px; }

/* Admin buttons emphasis */
button.primary { background: #2563eb; border-color: #1d4ed8; color: #ffffff; }
button.primary:hover { filter: brightness(1.05); box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25) inset; }

/* Editing state highlight */
#transaction-form.editing { border: 1px solid #1d4ed8; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2) inset; border-radius: 10px; padding: 8px; }

/* Collapsible meta summary */
.meta summary { cursor: pointer; list-style: none; padding: 10px 12px; border: 1px solid var(--outline); border-radius: 8px; background: #0f141b; color: var(--text); display: inline-flex; align-items: center; gap: 8px; }
.meta summary::marker { display: none; }
.meta details[open] summary { border-color: var(--primary-border); box-shadow: 0 0 0 2px var(--primary-glass) inset; }

/* Meta editor lists */
.meta-list li { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 8px 10px; background: #0f141b; border: 1px solid var(--outline); border-radius: 8px; margin-bottom: 8px; }
.meta-list .name { flex: 1; color: var(--text); }
.meta-actions { display: flex; gap: 8px; }
.meta-actions button { padding: 6px 8px; font-size: 12px; }
/* Collapsible transaction list using <details>/<summary> */
.item summary { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; list-style: none; cursor: pointer; }
.item summary::-webkit-details-marker { display: none; }
.item .details-body { margin-top: 8px; }
.item .meta-grid { display: flex; gap: 12px; flex-wrap: wrap; color: var(--muted); font-size: 12px; }

/* Icon-only buttons */
.icon-btn {
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
}
/* Умеренные цвета под общий тёмный стиль */
.icon-btn.primary { background: #1f2937; border-color: #374151; color: #e5e7eb; }
.icon-btn.secondary { background: #222a36; border-color: #344154; color: #e5e7eb; }
.icon-btn.danger { background: #1c2229; border-color: #343b44; color: #e7c8c8; }
.icon-btn:hover { opacity: 0.92; }

/* Minimal SVG icons */
.icon { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
.icon path, .icon circle, .icon rect { vector-effect: non-scaling-stroke; }

/* Modal panel under dark theme */
/* Диалоговые окна */
.modal-panel { background: var(--surface); color: var(--text); padding: 20px; border-radius: 12px; box-shadow: 0 12px 28px rgba(0,0,0,0.35); border: 1px solid var(--outline); }
dialog.modal-panel {
  margin: 0;
  width: min(680px, 92vw);
  max-width: 92vw;
  max-height: 84vh;
  overflow: auto;
}
dialog[open].modal-panel,
dialog.modal-panel.is-open {
  position: fixed;
  z-index: 1000;
  left: 50%;
  top: 10vh;
  transform: translateX(-50%);
}
@media (max-width: 640px) {
  dialog[open].modal-panel,
  dialog.modal-panel.is-open {
    top: 8vh;
    max-height: 84vh;
  }
}
dialog::backdrop { background: rgba(12,17,23,0.6); }

/* Заголовок и действия модалки */
.modal-header { margin-bottom: 10px; }
.modal-actions { margin-top: 6px; }

/* Сглаживание общего вида кнопок */
button.primary { background: #1f2937; border-color: #374151; color: #e5e7eb; }
button.primary:hover { filter: brightness(1.04); box-shadow: 0 0 0 2px rgba(55, 65, 81, 0.25) inset; }

/* ---------- Мобильная адаптация ---------- */
@media (max-width: 768px) {
  header, footer { padding: 12px; }
  main { padding: 12px; }
  .brand-row { gap: 8px; }
  .titles h1 { font-size: 20px; }
  .titles p { font-size: 12px; }

  .admin-bar { gap: 6px; }
  .chip { padding: 4px 8px; font-size: 11px; }
  .icon-btn { width: 36px; height: 36px; }
}

@media (max-width: 560px) {
  .brand-row { flex-direction: column; align-items: flex-start; }
  .crest { width: 36px; height: 36px; }

  /* Панель управления в шапке */
  .admin-bar { overflow-x: auto; padding-bottom: 6px; }
  .chip { white-space: nowrap; }

  /* Компактные элементы управления */
  .admin-controls { display: grid !important; grid-template-columns: 1fr 1fr; gap: 6px; }
  #auth-panel, #auth-user { width: 100%; }
  #auth-panel input, #auth-panel button, #auth-user button { width: 100%; }
  .admin-controls select, .admin-controls button { width: 100%; }

  /* Формы и блоки */
  .row { flex-direction: column; align-items: stretch; gap: 8px; }
  .add-form .row, .filters .row, .summary .row { flex-direction: column; }
  input, select, button { font-size: 14px; }
  input[type=date] { min-width: 0; width: 100%; }
  .actions { justify-content: space-between; }
  button, .icon-btn { min-height: 40px; }

  /* Списки транзакций */
  li.item { grid-template-columns: 1fr; }
  .item .actions { justify-content: flex-end; }

  /* Тикер */
  .ticker .marquee { gap: 12px; padding: 6px 10px; }
  .ticker .tick { padding-left: 8px; font-size: 13px; }

  /* Графики: ниже высота на телефонах */
  #chart-monthly { height: 180px; }
  #chart-categories { height: 220px; }
  #chart-balance { height: 180px; }
  #chart-donut { height: 220px; }

  /* Карточки и гриды в одну колонку */
  .grid { grid-template-columns: 1fr; }
}